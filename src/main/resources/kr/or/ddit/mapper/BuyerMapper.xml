<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.BuyerMapper">
<resultMap type="BuyerVO" id="BuyerMap" autoMapping="true">
	<id property="buyerId" column="BUYER_ID"/>

	<association property="lprod" javaType="LprodVO" autoMapping="true" />

	<collection property="prodList" javaType="list" ofType="ProdVO">
		<id property="prodId" column="PROD_ID"/>
		<result property="prodName" column="PROD_NAME" />
		<result property="prodCost" column="PROD_COST" />
		<result property="prodPrice" column="PROD_PRICE" />
	</collection>
</resultMap>
	<select id="selectBuyer" resultMap="BuyerMap">
		WITH BUYERVIEW AS(
			SELECT 
				BUYER_ID
				, BUYER_NAME
				, LPROD_GU
				, BUYER_BANK
				, BUYER_BANKNO
				, BUYER_BANKNAME
				, BUYER_ZIP
				, BUYER_ADD1
				, BUYER_ADD2
				, BUYER_COMTEL
				, BUYER_FAX
				, BUYER_MAIL
				, BUYER_CHARGER
				, BUYER_TELEXT
				, LPROD_NAME
			  FROM BUYER NATURAL JOIN LPROD
			 WHERE BUYER_ID=#{BUYERID}
		)
		SELECT 
			BUYERVIEW.*
			, PROD_ID
			, PROD_NAME
			, PROD_COST
			, PROD_PRICE			
		  FROM BUYERVIEW LEFT OUTER JOIN PROD ON (BUYERVIEW.BUYER_ID=PROD.BUYER_ID)
	</select>
</mapper>